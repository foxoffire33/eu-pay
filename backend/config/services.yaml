# config/services.yaml
parameters:
    psd2_webhook_secret: '%env(PSD2_WEBHOOK_SECRET)%'
    card_encryption_key: '%env(CARD_ENCRYPTION_KEY)%'
    hce_session_key_ttl: '%env(int:HCE_SESSION_KEY_TTL)%'
    blind_index_key: '%env(BLIND_INDEX_KEY)%'
    webauthn_rp_id: '%env(WEBAUTHN_RP_ID)%'
    webauthn_rp_name: '%env(WEBAUTHN_RP_NAME)%'

services:
    _defaults:
        autowire: true
        autoconfigure: true

    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'

    App\Service\OpenBankingService:
        arguments:
            $rabobankClientId: '%env(PSD2_CLIENT_ID)%'
            $rabobankClientSecret: '%env(PSD2_CLIENT_SECRET)%'
            $rabobankCertPath: '%env(PSD2_CERT_PATH)%'
            $rabobankKeyPath: '%env(PSD2_KEY_PATH)%'
            $rabobankApiBaseUrl: '%env(PSD2_API_BASE_URL)%'
            $appCallbackUrl: '%env(APP_CALLBACK_URL)%'

    App\Service\CardEncryptionService:
        arguments:
            $encryptionKey: '%card_encryption_key%'

    App\Service\HceProvisioningService:
        arguments:
            $sessionKeyTtl: '%hce_session_key_ttl%'

    App\Service\TopUpService:
        arguments:
            $creditorIban: '%env(EUPAY_CREDITOR_IBAN)%'
            $creditorName: '%env(EUPAY_CREDITOR_NAME)%'

    App\Service\Crypto\BlindIndexService:
        arguments:
            $blindIndexKey: '%blind_index_key%'

    App\Service\Crypto\EnvelopeEncryptionService: ~

    App\Service\WebAuthn\WebAuthnService:
        arguments:
            $rpId: '%webauthn_rp_id%'
            $rpName: '%webauthn_rp_name%'
            $webauthnChallengeCache: '@webauthn.challenge.cache'

    # Card Issuing â€” 17 EU-licensed providers for Visa/Mastercard NFC tap-to-pay
    # Change the alias below to switch provider (zero code changes needed)
    #
    # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    # â”‚ Provider         â”‚ Scheme    â”‚ License        â”‚ Country                  â”‚
    # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    # â”‚ Marqeta          â”‚ Visa      â”‚ CBI            â”‚ ğŸ‡®ğŸ‡ª Ireland               â”‚
    # â”‚ Adyen Issuing    â”‚ Visa+MC   â”‚ DNB            â”‚ ğŸ‡³ğŸ‡± Netherlands            â”‚
    # â”‚ Stripe Issuing   â”‚ Visa      â”‚ CBI            â”‚ ğŸ‡®ğŸ‡ª Ireland               â”‚
    # â”‚ Enfuce           â”‚ Visa+MC   â”‚ FIN-FSA        â”‚ ğŸ‡«ğŸ‡® Finland               â”‚
    # â”‚ Wallester        â”‚ Visa      â”‚ EFSA           â”‚ ğŸ‡ªğŸ‡ª Estonia               â”‚
    # â”‚ Paynetics        â”‚ Visa+MC   â”‚ BNB            â”‚ ğŸ‡§ğŸ‡¬ Bulgaria              â”‚
    # â”‚ Nexi Group       â”‚ Visa+MC   â”‚ Banca d'Italia â”‚ ğŸ‡®ğŸ‡¹ Italy                 â”‚
    # â”‚ Treezor          â”‚ MC        â”‚ ACPR           â”‚ ğŸ‡«ğŸ‡· France (SocGen)       â”‚
    # â”‚ Swan             â”‚ MC        â”‚ ACPR           â”‚ ğŸ‡«ğŸ‡· France                â”‚
    # â”‚ DECTA            â”‚ Visa+MC   â”‚ FCMC           â”‚ ğŸ‡±ğŸ‡» Latvia                â”‚
    # â”‚ Paynovate        â”‚ Visa+MC   â”‚ NBB            â”‚ ğŸ‡§ğŸ‡ª Belgium               â”‚
    # â”‚ Pecunpay         â”‚ Visa+MC   â”‚ BdE            â”‚ ğŸ‡ªğŸ‡¸ Spain                 â”‚
    # â”‚ Solaris          â”‚ Visa+MC   â”‚ BaFin (bank)   â”‚ ğŸ‡©ğŸ‡ª Germany               â”‚
    # â”‚ TransactPay      â”‚ Visa+MC   â”‚ MFSA           â”‚ ğŸ‡²ğŸ‡¹ Malta                 â”‚
    # â”‚ Vodeno/Aion      â”‚ Visa+MC   â”‚ NBB (bank)     â”‚ ğŸ‡§ğŸ‡ª Belgium               â”‚
    # â”‚ iCard            â”‚ Visa+MC   â”‚ BNB            â”‚ ğŸ‡§ğŸ‡¬ Bulgaria              â”‚
    # â”‚ Bankable         â”‚ Visa+MC   â”‚ CSSF           â”‚ ğŸ‡±ğŸ‡º Luxembourg             â”‚
    # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    App\Service\CardIssuing\CardIssuerInterface:
        alias: App\Service\CardIssuing\StripeCardIssuer

    # ğŸ‡®ğŸ‡ª Marqeta Europe Ltd â€” CBI Ireland, Visa
    App\Service\CardIssuing\MarqetaCardIssuer:
        arguments:
            $baseUrl: '%env(CARD_ISSUER_API_URL)%'
            $applicationToken: '%env(CARD_ISSUER_APP_TOKEN)%'
            $adminAccessToken: '%env(CARD_ISSUER_ADMIN_TOKEN)%'
            $cardProductToken: '%env(CARD_ISSUER_PRODUCT_TOKEN)%'
            $fundingSourceToken: '%env(CARD_ISSUER_FUNDING_TOKEN)%'

    # ğŸ‡³ğŸ‡± Adyen N.V. â€” DNB Netherlands, Visa+Mastercard
    App\Service\CardIssuing\AdyenCardIssuer:
        arguments:
            $baseUrl: '%env(ADYEN_ISSUING_API_URL)%'
            $apiKey: '%env(ADYEN_ISSUING_API_KEY)%'
            $balanceAccountId: '%env(ADYEN_BALANCE_ACCOUNT_ID)%'
            $balancePlatform: '%env(ADYEN_BALANCE_PLATFORM)%'

    # ğŸ‡®ğŸ‡ª Stripe Payments Europe Ltd â€” CBI Ireland, Visa
    App\Service\CardIssuing\StripeCardIssuer:
        arguments:
            $apiKey: '%env(STRIPE_ISSUING_SECRET_KEY)%'
            $baseUrl: 'https://api.stripe.com/v1'

    # ğŸ‡«ğŸ‡® Enfuce Financial Services â€” FIN-FSA Finland, Visa+Mastercard
    App\Service\CardIssuing\EnfuceCardIssuer:
        arguments:
            $baseUrl: '%env(ENFUCE_API_URL)%'
            $apiKey: '%env(ENFUCE_API_KEY)%'
            $apiSecret: '%env(ENFUCE_API_SECRET)%'
            $programId: '%env(ENFUCE_PROGRAM_ID)%'

    # ğŸ‡ªğŸ‡ª Wallester AS â€” Estonian FSA, Visa
    App\Service\CardIssuing\WallesterCardIssuer:
        arguments:
            $baseUrl: '%env(WALLESTER_API_URL)%'
            $apiKey: '%env(WALLESTER_API_KEY)%'
            $apiSecret: '%env(WALLESTER_API_SECRET)%'
            $productId: '%env(WALLESTER_PRODUCT_ID)%'

    # ğŸ‡§ğŸ‡¬ Paynetics AD â€” BNB Bulgaria, Visa+Mastercard
    App\Service\CardIssuing\PayneticsCardIssuer:
        arguments:
            $baseUrl: '%env(PAYNETICS_API_URL)%'
            $apiKey: '%env(PAYNETICS_API_KEY)%'
            $clientId: '%env(PAYNETICS_CLIENT_ID)%'
            $programmeId: '%env(PAYNETICS_PROGRAMME_ID)%'

    # ğŸ‡®ğŸ‡¹ Nexi Group S.p.A. â€” Banca d'Italia, Visa+Mastercard
    App\Service\CardIssuing\NexiCardIssuer:
        arguments:
            $baseUrl: '%env(NEXI_ISSUING_API_URL)%'
            $apiKey: '%env(NEXI_ISSUING_API_KEY)%'
            $merchantId: '%env(NEXI_MERCHANT_ID)%'
            $programmeToken: '%env(NEXI_PROGRAMME_TOKEN)%'

    # ğŸ‡«ğŸ‡· Treezor (SociÃ©tÃ© GÃ©nÃ©rale) â€” ACPR France, Mastercard
    App\Service\CardIssuing\TreezorCardIssuer:
        arguments:
            $baseUrl: '%env(TREEZOR_API_URL)%'
            $clientId: '%env(TREEZOR_CLIENT_ID)%'
            $clientSecret: '%env(TREEZOR_CLIENT_SECRET)%'
            $walletTypeId: '%env(TREEZOR_WALLET_TYPE_ID)%'

    # ğŸ‡«ğŸ‡· Swan SAS â€” ACPR France, Mastercard
    App\Service\CardIssuing\SwanCardIssuer:
        arguments:
            $baseUrl: '%env(SWAN_API_URL)%'
            $projectId: '%env(SWAN_PROJECT_ID)%'
            $accessToken: '%env(SWAN_ACCESS_TOKEN)%'

    # ğŸ‡±ğŸ‡» DECTA â€” FCMC Latvia, Visa+Mastercard
    App\Service\CardIssuing\DectaCardIssuer:
        arguments:
            $baseUrl: '%env(DECTA_API_URL)%'
            $apiKey: '%env(DECTA_API_KEY)%'
            $programmeId: '%env(DECTA_PROGRAMME_ID)%'

    # ğŸ‡§ğŸ‡ª Paynovate SA â€” NBB Belgium, Visa+Mastercard+UnionPay
    App\Service\CardIssuing\PaynovateCardIssuer:
        arguments:
            $baseUrl: '%env(PAYNOVATE_API_URL)%'
            $apiKey: '%env(PAYNOVATE_API_KEY)%'
            $merchantId: '%env(PAYNOVATE_MERCHANT_ID)%'

    # ğŸ‡ªğŸ‡¸ Pecunpay (Pecunia Cards EDE) â€” Bank of Spain, Visa+MC+UnionPay
    App\Service\CardIssuing\PecunpayCardIssuer:
        arguments:
            $baseUrl: '%env(PECUNPAY_API_URL)%'
            $apiKey: '%env(PECUNPAY_API_KEY)%'
            $programmeId: '%env(PECUNPAY_PROGRAMME_ID)%'

    # ğŸ‡©ğŸ‡ª Solaris SE â€” BaFin Germany (full banking licence), Visa+Mastercard
    App\Service\CardIssuing\SolarisCardIssuer:
        arguments:
            $baseUrl: '%env(SOLARIS_API_URL)%'
            $clientId: '%env(SOLARIS_CLIENT_ID)%'
            $clientSecret: '%env(SOLARIS_CLIENT_SECRET)%'
            $partnerId: '%env(SOLARIS_PARTNER_ID)%'

    # ğŸ‡²ğŸ‡¹ TransactPay â€” MFSA Malta, Visa+Mastercard
    App\Service\CardIssuing\TransactPayCardIssuer:
        arguments:
            $baseUrl: '%env(TRANSACTPAY_API_URL)%'
            $apiKey: '%env(TRANSACTPAY_API_KEY)%'
            $programmeToken: '%env(TRANSACTPAY_PROGRAMME_TOKEN)%'

    # ğŸ‡§ğŸ‡ª Vodeno / Aion Bank â€” NBB Belgium (full banking licence), Visa+MC
    App\Service\CardIssuing\VodenoCardIssuer:
        arguments:
            $baseUrl: '%env(VODENO_API_URL)%'
            $clientId: '%env(VODENO_CLIENT_ID)%'
            $clientSecret: '%env(VODENO_CLIENT_SECRET)%'

    # ğŸ‡§ğŸ‡¬ iCard AD â€” BNB Bulgaria, Visa+Mastercard
    App\Service\CardIssuing\ICardCardIssuer:
        arguments:
            $baseUrl: '%env(ICARD_API_URL)%'
            $apiKey: '%env(ICARD_API_KEY)%'
            $merchantId: '%env(ICARD_MERCHANT_ID)%'

    # ğŸ‡±ğŸ‡º Bankable â€” CSSF Luxembourg, Visa+Mastercard
    App\Service\CardIssuing\BankableCardIssuer:
        arguments:
            $baseUrl: '%env(BANKABLE_API_URL)%'
            $apiKey: '%env(BANKABLE_API_KEY)%'
            $programmeId: '%env(BANKABLE_PROGRAMME_ID)%'

    # Digital Euro (ECB CBDC) â€” stub until pilot 2027 / issuance 2029
    App\Service\DigitalEuro\DigitalEuroInterface:
        alias: App\Service\DigitalEuro\DigitalEuroStub

    App\Service\DigitalEuro\DigitalEuroStub: ~
